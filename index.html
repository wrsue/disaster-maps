<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é™¸ä¸Šå¼·é¢¨ç‰¹å ± | 2026-02-18 | ç½å®³è­¦æˆ’åœ°åœ–</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans TC', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background: #1a1a2e; color: #eee; }
    #header {
      background: linear-gradient(135deg, #16213e, #0f3460);
      padding: 14px 20px;
      border-bottom: 2px solid #e94560;
      display: flex; align-items: center; gap: 14px;
    }
    #header .icon { font-size: 2.2rem; }
    #header h1 { font-size: 1.2rem; margin-bottom: 4px; }
    #header .subtitle { font-size: 0.8rem; color: #aac4e0; }
    #map { width: 100%; height: calc(100vh - 130px); }
    #legend {
      position: absolute; bottom: 30px; right: 10px; z-index: 1000;
      background: rgba(22, 33, 62, 0.93);
      border: 1px solid #444; border-radius: 8px;
      padding: 12px 16px; min-width: 200px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    #legend h4 { font-size: 0.85rem; margin-bottom: 8px; color: #aac4e0; letter-spacing: 1px; }
    .legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; font-size: 0.82rem; }
    .legend-color { width: 16px; height: 16px; border-radius: 3px; flex-shrink: 0; }
    #info-bar {
      background: #16213e; border-top: 1px solid #333;
      padding: 6px 20px; font-size: 0.75rem; color: #889;
      display: flex; justify-content: space-between;
    }
    .popup-title { font-weight: bold; font-size: 1rem; margin-bottom: 4px; }
    .popup-status { padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; display: inline-block; margin-bottom: 6px; }
    .popup-warning { background: #FF4444; color: white; }
    .popup-clear { background: #4CAF50; color: white; }
    .popup-time { font-size: 0.78rem; color: #555; }
  </style>
</head>
<body>
<div id="header">
  <div class="icon">ğŸŒ¬ï¸</div>
  <div>
    <h1>é™¸ä¸Šå¼·é¢¨ç‰¹å ± â€” 2026-02-18</h1>
    <div class="subtitle">ç”Ÿæ•ˆæ™‚é–“ï¼š10:28 ï½ 2026-02-19 16:00ï¼ˆå°åŒ—æ™‚é–“ï¼‰ï½œå½±éŸ¿ç¸£å¸‚ï¼š14 å€‹ï½œè³‡æ–™ä¾†æºï¼šCWA W-C0033-001</div>
  </div>
</div>

<div id="map"></div>

<div id="legend">
  <h4>ğŸ“Š åœ–ä¾‹</h4>
  <div class="legend-item"><div class="legend-color" style="background:#FF4444;opacity:0.8"></div> é™¸ä¸Šå¼·é¢¨ç‰¹å ±ï¼ˆ14ç¸£å¸‚ï¼‰</div>
  <div class="legend-item"><div class="legend-color" style="background:#4CAF50;opacity:0.6"></div> ç„¡ç‰¹å ±ï¼ˆ8ç¸£å¸‚ï¼‰</div>
  <hr style="border-color:#333;margin:8px 0">
  <div style="font-size:0.75rem;color:#889">é»æ“Šç¸£å¸‚æŸ¥çœ‹è©³æƒ…</div>
</div>

<div id="info-bar">
  <span>âš™ï¸ è³‡æ–™ï¼šCWA æ°£è±¡å±€ W-C0033-001 | ç¹ªè£½ï¼šOpenClaw AI</span>
  <span>ğŸ“… 2026-02-18 10:28 TPE</span>
</div>

<script>
const windWarningCounties = new Set([
  'åŸºéš†å¸‚','æ¡ƒåœ’ç¸£','æ¡ƒåœ’å¸‚','æ–°ç«¹å¸‚','é›²æ—ç¸£','æ–°åŒ—å¸‚','å°å—å¸‚','è‡ºå—å¸‚',
  'æ¾æ¹–ç¸£','å°ä¸­å¸‚','è‡ºä¸­å¸‚','è‹—æ —ç¸£','å°æ±ç¸£','è‡ºæ±ç¸£','å±æ±ç¸£',
  'æ–°ç«¹ç¸£','å½°åŒ–ç¸£','å˜‰ç¾©ç¸£'
]);

const validStart = '2026-02-18 10:28';
const validEnd = '2026-02-19 16:00';

function getCountyDisplayName(name) {
  const map = {
    'å°æ±ç¸£':'è‡ºæ±ç¸£','å°å—å¸‚':'è‡ºå—å¸‚','å°ä¸­å¸‚':'è‡ºä¸­å¸‚',
    'å°åŒ—å¸‚':'è‡ºåŒ—å¸‚','æ¡ƒåœ’ç¸£':'æ¡ƒåœ’å¸‚'
  };
  return map[name] || name;
}

function isWarning(name) {
  return windWarningCounties.has(name);
}

function style(feature) {
  const name = feature.properties.COUNTYNAME || feature.properties.name || '';
  const warning = isWarning(name);
  return {
    fillColor: warning ? '#FF4444' : '#4CAF50',
    weight: 1.2,
    opacity: 1,
    color: 'white',
    fillOpacity: warning ? 0.72 : 0.45
  };
}

const map = L.map('map', {
  center: [23.5, 121.0],
  zoom: 7,
  zoomControl: true
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap contributors',
  maxZoom: 18
}).addTo(map);

// Add dark overlay tile
L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
  attribution: 'Â© Stadia Maps',
  maxZoom: 18,
  opacity: 0.25
}).addTo(map);

function onEachFeature(feature, layer) {
  const rawName = feature.properties.COUNTYNAME || feature.properties.name || '';
  const displayName = getCountyDisplayName(rawName);
  const warning = isWarning(rawName);
  
  const popupContent = `
    <div class="popup-title">${displayName}</div>
    <div class="popup-status ${warning ? 'popup-warning' : 'popup-clear'}">
      ${warning ? 'âš ï¸ é™¸ä¸Šå¼·é¢¨ç‰¹å ±' : 'âœ… ç„¡ç‰¹å ±'}
    </div>
    ${warning ? `<div class="popup-time">â° ${validStart} ï½ ${validEnd} (TPE)</div>` : ''}
  `;
  layer.bindPopup(popupContent, { maxWidth: 220 });
  
  layer.on({
    mouseover: e => e.target.setStyle({ weight: 2.5, color: '#FFD700', fillOpacity: 0.9 }),
    mouseout: e => geojsonLayer.resetStyle(e.target),
    click: e => map.fitBounds(e.target.getBounds(), { padding: [30, 30] })
  });
}

// Fetch GeoJSON from CDN
fetch('https://raw.githubusercontent.com/g0v/twgeojson/master/json/twCounty2010.geo.json')
  .then(r => r.json())
  .then(data => {
    window.geojsonLayer = L.geoJSON(data, {
      style: style,
      onEachFeature: onEachFeature
    }).addTo(map);
  })
  .catch(err => console.error('GeoJSON load failed:', err));
</script>
</body>
</html>
