<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>é™¸ä¸Šå¼·é¢¨ç‰¹å ±(é»ƒè‰²ç‡ˆè™Ÿ) | ç½å®³è­¦æˆ’åœ°åœ–</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans TC','å¾®è»Ÿæ­£é»‘é«”',sans-serif;background:#1a1a2e;color:#eee}
    #header{background:linear-gradient(135deg,#16213e,#0f3460);padding:12px 18px;border-bottom:3px solid #FFFF00;display:flex;align-items:center;gap:12px}
    .h-icon{font-size:2rem}
    #header h1{font-size:1.15rem;margin-bottom:3px}
    #header .sub{font-size:0.75rem;color:#aac4e0;line-height:1.5}
    #map{width:100%;height:calc(100vh - 120px)}
    #legend{position:absolute;bottom:28px;right:10px;z-index:1000;background:rgba(22,33,62,.92);border:1px solid #444;border-radius:8px;padding:12px 16px;min-width:210px;box-shadow:0 4px 12px rgba(0,0,0,.5)}
    #legend h4{font-size:.82rem;margin-bottom:7px;color:#aac4e0;letter-spacing:1px}
    .li{display:flex;align-items:center;gap:8px;margin:4px 0;font-size:.8rem}
    .lc{width:15px;height:15px;border-radius:3px;flex-shrink:0}
    #footer{background:#16213e;border-top:1px solid #333;padding:5px 18px;font-size:.72rem;color:#889;display:flex;justify-content:space-between}
    .pt{font-weight:bold;font-size:.95rem;margin-bottom:3px}
    .ps{padding:2px 8px;border-radius:4px;font-size:.78rem;display:inline-block;margin-bottom:5px}
    .pw{background:#FFFF00;color:#fff}
    .pc{background:#4CAF50;color:#fff}
    .pi{font-size:.75rem;color:#555;margin-top:4px}
    .ta{font-size:.72rem;color:#888;margin-top:6px;border-top:1px solid #eee;padding-top:5px;max-height:80px;overflow-y:auto}
  </style>
</head>
<body>
<div id="header">
  <div class="h-icon">ğŸŒ¬ï¸</div>
  <div>
    <h1>é™¸ä¸Šå¼·é¢¨ç‰¹å ±(é»ƒè‰²ç‡ˆè™Ÿ)</h1>
    <div class="sub">
      ç”Ÿæ•ˆï¼š2026-02-19 04:30 ï½ 2026-02-19 16:00ï¼ˆTPEï¼‰ï½œå½±éŸ¿ï¼š2 ç¸£å¸‚ ï¼ˆç²¾ç¢ºé„‰é®ï¼š39 å€‹ï¼ˆä¿å®ˆä¼°è¨ˆï¼‰ï¼‰ï¼‰ï½œğŸ”´ ç”Ÿæ•ˆä¸­<br/>
      è³‡æ–™ä¾†æºï¼šCWA CAP | ç™¼å¸ƒï¼š2026-02-18 22:35
    </div>
  </div>
</div>
<div id="map"></div>
<div id="legend">
  <h4>ğŸ“Š åœ–ä¾‹</h4>
  <div class="li"><div class="lc" style="background:#FFFF00;opacity:.8"></div>é™¸ä¸Šå¼·é¢¨ç‰¹å ±(é»ƒè‰²ç‡ˆè™Ÿ)ï¼ˆ10ç¸£å¸‚ï¼‰</div>
  <div class="li"><div class="lc" style="background:#4CAF50;opacity:.55"></div>ç„¡ç‰¹å ±</div>
  <hr style="border-color:#333;margin:7px 0"/>
  <div style="font-size:.72rem;color:#889">é»æ“Šç¸£å¸‚æŸ¥çœ‹è©³æƒ…</div>
</div>
<div id="footer">
  <span>âš™ï¸ è³‡æ–™ï¼šCWA CAP | ç¹ªè£½ï¼šOpenClaw AI</span>
  <span>ğŸ“… 2026-02-18 22:35 TPE</span>
</div>
<script>
const WARNING_AREAS = new Set(["å±æ±ç¸£ä¸‰åœ°é–€é„‰", "å±æ±ç¸£ä¹å¦‚é„‰", "å±æ±ç¸£ä½³å†¬é„‰", "å±æ±ç¸£ä¾†ç¾©é„‰", "å±æ±ç¸£å…§åŸ”é„‰", "å±æ±ç¸£å—å·é„‰", "å±æ±ç¸£å±æ±å¸‚", "å±æ±ç¸£å´é ‚é„‰", "å±æ±ç¸£æ†æ˜¥é®", "å±æ±ç¸£æ–°åœ’é„‰", "å±æ±ç¸£æ–°åŸ¤é„‰", "å±æ±ç¸£æ˜¥æ—¥é„‰", "å±æ±ç¸£æ±æ¸¯é®", "å±æ±ç¸£æ‹å¯®é„‰", "å±æ±ç¸£æ‹å±±é„‰", "å±æ±ç¸£æ—é‚Šé„‰", "å±æ±ç¸£æ³°æ­¦é„‰", "å±æ±ç¸£æ»¿å·é„‰", "å±æ±ç¸£æ½®å·é®", "å±æ±ç¸£ç‰¡ä¸¹é„‰", "å±æ±ç¸£ç…å­é„‰", "å±æ±ç¸£ç‰çƒé„‰", "å±æ±ç¸£ç‘ªå®¶é„‰", "å±æ±ç¸£ç«¹ç”°é„‰", "å±æ±ç¸£è¬ä¸¹é„‰", "å±æ±ç¸£è¬å·’é„‰", "å±æ±ç¸£è»ŠåŸé„‰", "å±æ±ç¸£é‡Œæ¸¯é„‰", "å±æ±ç¸£é•·æ²»é„‰", "å±æ±ç¸£éœ§è‡ºé„‰", "å±æ±ç¸£é«˜æ¨¹é„‰", "å±æ±ç¸£é¹½åŸ”é„‰", "å±æ±ç¸£éºŸæ´›é„‰", "æ¾æ¹–ç¸£ä¸ƒç¾é„‰", "æ¾æ¹–ç¸£æœ›å®‰é„‰", "æ¾æ¹–ç¸£æ¹–è¥¿é„‰", "æ¾æ¹–ç¸£ç™½æ²™é„‰", "æ¾æ¹–ç¸£è¥¿å¶¼é„‰", "æ¾æ¹–ç¸£é¦¬å…¬å¸‚"]);
const WARNING_COUNTIES = new Set(["å±æ±ç¸£", "æ¾æ¹–ç¸£"]);
const IS_TOWNSHIP = true;
const MAP_COLOR = "#FFFF00";
const HEADLINE = "é™¸ä¸Šå¼·é¢¨ç‰¹å ±";
const EFFECTIVE = "2026-02-19 10:38";
const EXPIRES = "2026-02-19 13:00";
const WEB_URL = "https://www.cwa.gov.tw/V8/C/P/Warning/W25.html";
const TOWNSHIP_URL = "https://wrsue.github.io/disaster-maps/townships.geojson";
const COUNTY_URL = "https://raw.githubusercontent.com/g0v/twgeojson/master/json/twCounty2010.geo.json";

const NORMALIZE = {"å°æ±ç¸£":"è‡ºæ±ç¸£","å°å—å¸‚":"è‡ºå—å¸‚","å°ä¸­å¸‚":"è‡ºä¸­å¸‚","å°åŒ—å¸‚":"è‡ºåŒ—å¸‚","æ¡ƒåœ’ç¸£":"æ¡ƒåœ’å¸‚"};
function norm(n){return NORMALIZE[n]||n;}

const map = L.map('map',{center:[23.5,121.0],zoom:7});
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
  attribution:'Â© OpenStreetMap contributors Â© CARTO',subdomains:'abcd',maxZoom:19
}).addTo(map);

let gl;

if (IS_TOWNSHIP) {
  // é„‰é®å±¤ç´šåœ°åœ–
  fetch(TOWNSHIP_URL).then(r=>r.json()).then(data=>{
    gl = L.geoJSON(data, {
      style: f => {
        const town = f.properties.TOWNNAME||'';
        const county = norm(f.properties.COUNTYNAME||'');
        const key1 = county + town;
        const key2 = county.replace('è‡º','å°') + town;
        const w = WARNING_AREAS.has(key1) || WARNING_AREAS.has(key2) || WARNING_AREAS.has(town);
        return {fillColor:w?MAP_COLOR:'#4CAF50',weight:0.8,opacity:1,color:'rgba(255,255,255,0.4)',fillOpacity:w?.78:.35};
      },
      onEachFeature: (f,layer) => {
        const town = f.properties.TOWNNAME||'';
        const county = norm(f.properties.COUNTYNAME||'');
        const key1 = county + town;
        const key2 = county.replace('è‡º','å°') + town;
        const w = WARNING_AREAS.has(key1)||WARNING_AREAS.has(key2)||WARNING_AREAS.has(town);
        const pop=`<div class="pt">${county} ${town}</div>
          <span class="ps ${w?'pw':'pc'}">${w?'âš ï¸ '+HEADLINE:'âœ… ç„¡ç‰¹å ±'}</span>
          ${w?`<div class="pi">â° ${EFFECTIVE} ï½ ${EXPIRES}</div>`:''}
          ${WEB_URL&&w?`<div style="margin-top:6px"><a href="${WEB_URL}" target="_blank" style="color:#64b5f6;font-size:.75rem">ğŸ“ å®˜æ–¹é€£çµ</a></div>`:''}`;
        layer.bindPopup(pop,{maxWidth:240});
        layer.on({
          mouseover:e=>e.target.setStyle({weight:2,color:'#FFD700',fillOpacity:.95}),
          mouseout:e=>gl.resetStyle(e.target),
          click:e=>map.fitBounds(e.target.getBounds(),{padding:[40,40]})
        });
      }
    }).addTo(map);
  }).catch(e=>console.error('Township GeoJSON error:',e));
} else {
  // ç¸£å¸‚å±¤ç´šåœ°åœ–
  fetch(COUNTY_URL).then(r=>r.json()).then(data=>{
    gl = L.geoJSON(data, {
      style: f => {
        const nm = norm(f.properties.COUNTYNAME||f.properties.name||'');
        const w = WARNING_COUNTIES.has(nm)||WARNING_COUNTIES.has(f.properties.COUNTYNAME||'');
        return {fillColor:w?MAP_COLOR:'#4CAF50',weight:1.2,opacity:1,color:'#fff',fillOpacity:w?.72:.45};
      },
      onEachFeature: (f,layer) => {
        const nm = norm(f.properties.COUNTYNAME||f.properties.name||'');
        const w = WARNING_COUNTIES.has(nm);
        const pop=`<div class="pt">${nm}</div>
          <span class="ps ${w?'pw':'pc'}">${w?'âš ï¸ '+HEADLINE:'âœ… ç„¡ç‰¹å ±'}</span>
          ${w?`<div class="pi">â° ${EFFECTIVE} ï½ ${EXPIRES}</div>`:''}
          ${WEB_URL&&w?`<div style="margin-top:6px"><a href="${WEB_URL}" target="_blank" style="color:#64b5f6;font-size:.75rem">ğŸ“ å®˜æ–¹é€£çµ</a></div>`:''}`;
        layer.bindPopup(pop,{maxWidth:240});
        layer.on({
          mouseover:e=>e.target.setStyle({weight:2.5,color:'#FFD700',fillOpacity:.9}),
          mouseout:e=>gl.resetStyle(e.target),
          click:e=>map.fitBounds(e.target.getBounds(),{padding:[30,30]})
        });
      }
    }).addTo(map);
  }).catch(e=>console.error('County GeoJSON error:',e));
}
</script>
</body>
</html>